# services is a version 2 only feature
version: '2.1'

services:
  app:
    image: "{{ img_name }}"
    domainname: "{{ dns_domain }}"
{% if labels is defined %}
{% for label in labels %}
    labels:
      - {{ label }}
{% endfor %}
{% endif %}
    restart: {{ restart | default(default_restart) }}
    mem_limit: {{ memory | default(default_memory) }}
{% if network_mode is defined %}
    network_mode: {{ network_mode | default(default_network_mode) }}
{% endif %}
{% if dns is defined %}
    dns: {{ dns }}
{% endif %}
    command: {{ command }}
{% if ports is defined %}
    ports:
{% if service_port is defined %}
      - {{ service_port | lower }}
{% endif %}
{% for port in ports %}
      - {{ port | lower }}
{% endfor %}
{% endif %}
{% if env_vars is defined %}
    environment:
{% if event_management is defined %}
      - ZABBIX_SERVER={{ event_management }}
{% endif %}
{% if svc_discovery is defined %}
      - SVC_DISCOVERY={{ svc_discovery }}
{% endif %}
{% for env in env_vars %}
      - {{ env }}
{% endfor %}
{% endif %}
